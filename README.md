CREATE OR REPLACE PROCEDURE P_PROCESS_DATA_INSERT (
    P_COIL_ID   IN  VARCHAR2,
    MIN_RUNID   IN  VARCHAR2,
    MAX_RUNID   IN  VARCHAR2,
    ISSUCCESS   OUT VARCHAR2
) AS
    V_START_TIME         TIMESTAMP := SYSDATE;
    V_END_TIME           TIMESTAMP := SYSDATE;
    V_WEIGHT             NUMBER;
    V_MOTHER_COIL        VARCHAR2(50);
    V_CUSTOMER_THICKNESS NUMBER;
    V_CUST_WIDTH         NUMBER;
    V_CUST_LENGTH        NUMBER;
    V_CUST_TDC           VARCHAR2(20);
    V_COIL_THICKNESS     NUMBER;
    V_WIDTH              NUMBER := 0;
    COIL_LENGTH_REAL     NUMBER := 0;
BEGIN
    -- 1. Fetch coil data
    SELECT coil_weight,
           mother_coil_id,
           customer_thickness,
           customer_width,
           customer_length,
           customer_tdc,
           coil_thickness
      INTO V_WEIGHT,
           V_MOTHER_COIL,
           V_CUSTOMER_THICKNESS,
           V_CUST_WIDTH,
           V_CUST_LENGTH,
           V_CUST_TDC,
           V_COIL_THICKNESS
      FROM t_ecl_pdi_level2
     WHERE coil_id = P_COIL_ID;

    -- 2. Insert into PDO table
    INSERT INTO T_ECL_PDO_LEVEL2 (
        COIL_ID, COIL_THICKNESS, COIL_WIDTH, COIL_LENGTH, COIL_WEIGHT,
        MOTHER_COIL_ID, COIL_TDC, COIL_ODIA, COIL_IDIA, COIL_AGE,
        COIL_GRADE, CUSTOMER_NAME, CUSTOMER_THICKNESS, CUSTOMER_WIDTH,
        CUSTOMER_LENGTH, CUSTOMER_TDC, OUTPUT_THICKNESS, SLEEVE_USED,
        OUTPUT_WIDTH, ENTRY_TENSION, EXIT_TENSION, START_TIME, END_TIME,
        DRIVE_CURRENT, DRIVE_CURRENT_MIN, DRIVE_CURRENT_MAX,
        DRIVE_CURRENT_AVG, MILL_SPEED, MILL_SPEED_MIN, MILL_SPEED_MAX,
        MILL_SPEED_AVG, UNCOILER_TENSION, UNCOILER_SPEED, UNCOILER_TORQUE,
        UNCOILER_CURRENT, EPC_STATUS, CPC_STATUS, PRIMARY_TANK_CONCENTRATION,
        PRIMARY_TANK_TEMP, PRIMARY_TANK_LEVEL, PRIMARY_TANK_CIR_FLOW_RATE,
        PRIMARY_TANK_SPRAY_FLOW_RATE, ECL_TANK_CONCENTRATION, ECL_TANK_TEMP,
        ECL_TANK_LEVEL, ECL_TANK_SPRAY_HALF_FLOW_RATE,
        ECL_TANK_SPRAY3QUARFLOW_RATE, ELECTRODE_VOLTAGE, ELECTRODE_VOLTAGE_MIN,
        ELECTRODE_VOLTAGE_MAX, ELECTRODE_VOLTAGE_AVG, ELECTRODE_CURRENT,
        ELECTRODE_CURRENT_MIN, ELECTRODE_CURRENT_MAX, ELECTRODE_CURRENT_AVG,
        RECTIFIER1_CURRENT, RECTIFIER1_VOLTAGE, RECTIFIER1_CURRENT_DENSITY,
        RECTIFIER2_CURRENT, RECTIFIER2_VOLTAGE, RECTIFIER2_CURRENT_DENSITY,
        TANK1_LEVEL, TANK1_LEVEL_MIN, TANK1_LEVEL_MAX, TANK1_LEVEL_AVG,
        TANK1_TEMP, TANK1_TEMP_MIN, TANK1_TEMP_MAX, TANK1_TEMP_AVG,
        TANK1_FLOW, TANK1_FLOW_MIN, TANK1_FLOW_MAX, TANK1_FLOW_AVG,
        TANK2_LEVEL, TANK2_LEVEL_MIN, TANK2_LEVEL_MAX, TANK2_LEVEL_AVG,
        TANK2_TEMP, TANK2_TEMP_MIN, TANK2_TEMP_MAX, TANK2_TEMP_AVG,
        TANK2_FLOW, TANK2_FLOW_MIN, TANK2_FLOW_MAX, TANK2_FLOW_AVG,
        RINSE_WATER_TEMP, RINSE_WATER_TEMP_MIN, RINSE_WATER_TEMP_MAX,
        RINSE_WATER_TEMP_AVG, RINSE_WATER_PRESSURE, RINSE_WATER_PRESSURE_MIN,
        RINSE_WATER_PRESSURE_MAX, RINSE_WATER_PRESSURE_AVG,
        RINSE_TANK_HALF_FLOW_RATE, RINSE_TANK3QUAR_FLOW_RATE,
        TENSIONER_ROLL_TENSION, TENSIONER_ROLL_TENSION_MIN,
        TENSIONER_ROLL_TENSION_MAX, TENSIONER_ROLL_TENSION_AVG,
        TENSIONER_ROLL_SPEED, TENSIONER_ROLL_SPEED_MIN,
        TENSIONER_ROLL_SPEED_MAX, TENSIONER_ROLL_SPEED_AVG, RINSE_TANK_TEMP,
        RINSE_TANK_PH, RINSE_TANK_CHLORIDE, DRIER_TEMP, B1A_TENSION,
        B1A_TENSION_MIN, B1A_TENSION_MAX, B1A_TENSION_AVG, B1A_SPEED,
        B1A_SPEED_MIN, B1A_SPEED_MAX, B1A_SPEED_AVG, B1A_TORQUE,
        B1A_TORQUE_MIN, B1A_TORQUE_MAX, B1A_TORQUE_AVG, B1A_CURRENT,
        B1A_CURRENT_MIN, B1A_CURRENT_MAX, B1A_CURRENT_AVG, B1B_TENSION,
        B1B_TENSION_MIN, B1B_TENSION_MAX, B1B_TENSION_AVG, B1B_SPEED,
        B1B_SPEED_MIN, B1B_SPEED_MAX, B1B_SPEED_AVG, B1B_TORQUE,
        B1B_TORQUE_MIN, B1B_TORQUE_MAX, B1B_TORQUE_AVG, B1B_CURRENT,
        B1B_CURRENT_MIN, B1B_CURRENT_MAX, B1B_CURRENT_AVG, B2A_TENSION,
        B2A_TENSION_MIN, B2A_TENSION_MAX, B2A_TENSION_AVG, B2A_SPEED,
        B2A_SPEED_MIN, B2A_SPEED_MAX, B2A_SPEED_AVG, B2A_TORQUE,
        B2A_TORQUE_MIN, B2A_TORQUE_MAX, B2A_TORQUE_AVG, B2A_CURRENT,
        B2A_CURRENT_MIN, B2A_CURRENT_MAX, B2A_CURRENT_AVG, B2B_TENSION,
        B2B_TENSION_MIN, B2B_TENSION_MAX, B2B_TENSION_AVG, B2B_SPEED,
        B2B_SPEED_MIN, B2B_SPEED_MAX, B2B_SPEED_AVG, B2B_TORQUE,
        B2B_TORQUE_MIN, B2B_TORQUE_MAX, B2B_TORQUE_AVG, B2B_CURRENT,
        B2B_CURRENT_MIN, B2B_CURRENT_MAX, B2B_CURRENT_AVG, BRUSH1_CURRENT,
        BRUSH2_CURRENT, BRUSH3_CURRENT, BRUSH4_CURRENT, BRUSH5_CURRENT,
        BRUSH6_CURRENT, RECOILER_TENSION, RECOILER_SPEED, RECOILER_TORQUE,
        RECOILER_CURRENT, CALCULATED_WEIGHT, ACTUAL_WEIGHT, NEXT_PROCESS,
        HOLD_REASON_DESC, REASON_CODE, REMARKS
    )
    SELECT 
        P_COIL_ID,
        V_COIL_THICKNESS,
        V_WIDTH,
        COIL_LENGTH_REAL,
        V_WEIGHT,
        V_MOTHER_COIL,
        0,0,0,0,
        'A',
        'ABC',
        V_CUSTOMER_THICKNESS,
        V_CUST_WIDTH,
        V_CUST_LENGTH,
        V_CUST_TDC,
        V_COIL_THICKNESS,
        0,0,0,0,
        V_START_TIME,
        SYSDATE,
        -- Remaining columns filled with zeros
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
    FROM T_PERIODIC_VALUE_LOG
     WHERE RUN_ID BETWEEN MIN_RUNID AND MAX_RUNID
       AND LINE_SPEED_SCADA > 15;

    -- 3. Mark success
    ISSUCCESS := 'S';
    COMMIT;

EXCEPTION
    WHEN NO_DATA_FOUND THEN
        ISSUCCESS := 'F';
    WHEN OTHERS THEN
        ISSUCCESS := 'F';
        ROLLBACK;
        -- Optional: re-raise to debug
        -- RAISE;
END P_PROCESS_DATA_INSERT;
/