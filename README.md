SELECT 
    CASE 
        WHEN ROW_NUMBER() OVER (PARTITION BY PDI.TC_COIL_NUMBER ORDER BY PDO.TCIP_CIL_END_TIME DESC, PDO.TCIP_PRODUCT_COIL) = 1 
        THEN PDI.TC_COIL_NUMBER 
        ELSE '' 
    END AS TC_COIL_NUMBER,
    CASE 
        WHEN ROW_NUMBER() OVER (PARTITION BY PDI.TC_COIL_NUMBER ORDER BY PDO.TCIP_CIL_END_TIME DESC, PDO.TCIP_PRODUCT_COIL) = 1 
        THEN PDI.TC_WEIGHT 
        ELSE NULL 
    END AS TC_WEIGHT,
    PDO.TCIP_PRODUCT_COIL,
    PDO.TCPI_ACTUAL_WT,
    PDO.TCIP_CIL_END_TIME
FROM 
    T_COL_COT_PDI_L3 PDI
JOIN 
    T_COL_COIL_INFO_PDO PDO
ON 
    PDI.TC_COIL_NUMBER = PDO.TCIP_INPUT_COIL 
WHERE 
    PDO.TCIP_CIL_END_TIME > TO_DATE('27-APR-25','DD-MON-YY')
ORDER BY 
    MAX(PDO.TCIP_CIL_END_TIME) OVER (PARTITION BY PDI.TC_COIL_NUMBER) DESC,
    PDI.TC_COIL_NUMBER,
    PDO.TCIP_PRODUCT_COIL;