WITH Parent_Coils AS (
    SELECT 
        PDI.TC_COIL_NUMBER AS TC_COIL_NUMBER,
        PDI.TC_WEIGHT AS TC_WEIGHT,
        PDI.TC_ID_Message,
        NULL AS TCIP_PRODUCT_COIL,
        NULL AS TCPI_ACTUAL_WT,
        NULL AS TCIP_CIL_END_TIME,
        0 AS SORT_ORDER
    FROM 
        T_COL_COT_PDI_L3 PDI
    WHERE EXISTS (
        SELECT 1 
        FROM T_COL_COIL_INFO_PDO PDO
        WHERE PDI.TC_COIL_NUMBER = PDO.TCIP_INPUT_COIL
          AND PDO.TCIP_CIL_END_TIME > TO_DATE('24-APR-25', 'DD-MON-YY')
    )
),
Child_Coils AS (
    SELECT 
        NULL AS TC_COIL_NUMBER,
        NULL AS TC_WEIGHT,
        PDI.TC_ID_Message,
        PDO.TCIP_PRODUCT_COIL,
        PDO.TCPI_ACTUAL_WT,
        PDO.TCIP_CIL_END_TIME,
        1 AS SORT_ORDER
    FROM 
        T_COL_COT_PDI_L3 PDI
    JOIN 
        T_COL_COIL_INFO_PDO PDO
    ON 
        PDI.TC_COIL_NUMBER = PDO.TCIP_INPUT_COIL
    WHERE 
        PDO.TCIP_CIL_END_TIME > TO_DATE('24-APR-25', 'DD-MON-YY')
)
SELECT * 
FROM (
    SELECT * FROM Parent_Coils
    UNION ALL
    SELECT * FROM Child_Coils
)
ORDER BY 
    TC_ID_Message DESC,
    SORT_ORDER,
    TCIP_PRODUCT_COIL;