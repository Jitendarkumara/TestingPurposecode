SELECT 
    CASE WHEN RN = 1 THEN PDI.TC_COIL_NUMBER ELSE NULL END AS TC_COIL_NUMBER,
    CASE WHEN RN = 1 THEN PDI.TC_WEIGHT ELSE NULL END AS TC_WEIGHT,
    PDI.TC_ID_Message,
    PDO.TCIP_PRODUCT_COIL,
    PDO.TCPI_ACTUAL_WT,
    PDO.TCIP_CIL_END_TIME
FROM 
    (
    SELECT 
        PDI.TC_COIL_NUMBER,
        PDI.TC_WEIGHT,
        PDI.TC_ID_Message,
        PDO.TCIP_PRODUCT_COIL,
        PDO.TCPI_ACTUAL_WT,
        PDO.TCIP_CIL_END_TIME,
        ROW_NUMBER() OVER (PARTITION BY PDI.TC_COIL_NUMBER ORDER BY PDO.TCIP_CIL_END_TIME) AS RN
    FROM 
        T_COL_COT_PDI_L3 PDI
    JOIN 
        T_COL_COIL_INFO_PDO PDO
    ON 
        PDI.TC_COIL_NUMBER = PDO.TCIP_INPUT_COIL
    WHERE 
        PDO.TCIP_CIL_END_TIME > TO_DATE('24-APR-25', 'DD-MON-YY')
    ) X
ORDER BY 
    X.TC_ID_Message DESC,
    X.TCIP_CIL_END_TIME;